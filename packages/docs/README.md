# PreTeXt Docs

This repository contains PreTeXt documentation created using [Nextra](https://nextra.site/)'s architecture
(which in turn is based on [Nextjs](https://nextjs.org/)). It was created to be a reference for the PreTeXt
tags so that one can quickly look up details about a specific tag without reading about surrounding features. ([link to documentation website generated by this repository](https://siefkenj.github.io/pretext-book/docs))

The documentation should heavily feature examples written as _PreTeXt Fragments_. A PreTeXt fragment is a
part of PreTeXt code that is not part of a larger document. See `packages/fragment` for details about PreTeXt Fragments.

## Writing Documentation

### Reference documentation

Reference documentation is meant to give the reader an idea about how a tag or option is used, at a glance. It can also include
notes about common pitfalls, but a reference is not a place for a discussion about good textbook authorship, etc. (That belongs in
[_The Guide_](https://pretextbook.org/doc/guide/html/guide-toc.html)).
If you are writing documentation for tags (e.g. `<m>`, `<p>`, etc.) find the relevant `*.mdx` file in `pages/reference/elements` and edit it.
Good reference documentation should include

-   **A short description of what the tag does** as the first paragraph. This description should be no more than two paragraphs (eventually it will
    become part of the hover text that pops up when you type pretext in vscode)
-   **Examples showing many use cases**. Often times a tag has several attributes that change what it does. It's useful to have examples of all
    (but if there is a combinatorial explosion, not all combinations) of the attributes.
-   **Links to The Guide where appropriate**. Reference documentation should link to [_The Guide_](https://pretextbook.org/doc/guide/html/guide-toc.html)
    when longer and more philosophical exposition is needed.

_Notes_:

-   You can call tags _tags_ or _elements_. Your choice.
-   Tags should always include `<>` brackets. For example, write `<p>` instead of `p` when talking about the `<p>` tag.
-   Examples should be word-wrapped at 80 characters so a horizontal scrollbar is not needed.
-   **Do not** commit your rendered fragment files (those in `examples/`). I will re-render and commit those files as needed
    as the docs are updated.
-   See [Divio](https://docs.divio.com/documentation-system/reference/) description of good reference documentation.

See `pages/reference/elements/exercise.mdx` for an advanced example of writing reference documentation.

## Dev Instructions

In the root directory (i.e. at the same level as the root of `packages/docs` (_not_ the directory that this README is in)) run `npm install`.

If you are on an ARM-based Mac, you will need to also run `npm install @rollup/rollup-darwin-arm64`.
(This step is not required on other architectures or operating systems.)

Then, in this directory (the directory of this README), run

```
npm run dev
```

to start in development mode. This will start a live-reloading server that will respond to changes in the markdown files.

If this doesn't work, you might need to run `npm run build` inside a few other package directories.  Run this command from inside `packages/wasm`, `packages/fragments`, and `packages/jsx` in order (you can ignore errors when building `jsx`).

### Building

To build, run

```
npm run build
```

The fully build documentation should be available in the `out/` directory.

**Warning:** By default the documentation assumes that it is being served from the root of URL. It is
not relocatable to a subfolder. There are workarounds in place for deploying to github pages. See `next.config.mjs` for details.

### Building/Rebuilding Examples

Examples are dynamically via a built-in version of PreTeXt. See `packages/wasm` for details about the built-in version.

When running in dev mode (`npm run dev`) additional information is passed to the page preview in the _Debug Info_ tab on each example.
This tab will not show up when the site is built in production mode.

It is a good idea to check the PreTeXt log info in the _Debug Info_ tab to make sure you're not creating an example with
invalid PreTeXt.

### Adding element and attribute file templates

When the schema is updated, to get new template files for new elements or attributes, you can run a script to add just missing pages.  This can be done with `tsx`, from the root of the `pacckages/docs` folder:

```
npx tsx scripts/create-element-templates.ts
```

New files will be put directly into the `pages/reference/` folders (either `elements` or `attributes`).

To update the list of elements to be displayed, run `npx tsx scripts/dump-all-elements.ts` and copy the output to the appropriate place in `pages/reference/_meta.tsx`.

After doing this, restart `npm run dev` to see changes.
